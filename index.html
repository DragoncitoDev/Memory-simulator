<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Gesti√≥n de Memoria y Almacenamiento</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { Play, Pause, RotateCcw, Cpu, HardDrive, Zap, Info } = lucide;

        const MemoryDiskSimulator = () => {
          const [activeTab, setActiveTab] = useState('compaction');
          const [isRunning, setIsRunning] = useState(false);
          const [speed, setSpeed] = useState(1000);
          const [step, setStep] = useState(0);
          
          // Compactaci√≥n de Memoria
          const [memoryBlocks, setMemoryBlocks] = useState([
            { id: 1, size: 100, type: 'process', name: 'Chrome.exe', color: 'bg-blue-500' },
            { id: 2, size: 50, type: 'free', name: 'Libre', color: 'bg-gray-600' },
            { id: 3, size: 80, type: 'process', name: 'VSCode.exe', color: 'bg-green-500' },
            { id: 4, size: 70, type: 'free', name: 'Libre', color: 'bg-gray-600' },
            { id: 5, size: 90, type: 'process', name: 'Spotify.exe', color: 'bg-purple-500' },
            { id: 6, size: 110, type: 'free', name: 'Libre', color: 'bg-gray-600' }
          ]);
          const [allocationMethod, setAllocationMethod] = useState('first');
          const [compactionComplete, setCompactionComplete] = useState(false);
          
          // Cach√©
          const [cachePolicy, setCachePolicy] = useState('LRU');
          const [cacheBlocks, setCacheBlocks] = useState(Array(8).fill(null));
          const [cacheRequests, setCacheRequests] = useState([]);
          const [currentRequest, setCurrentRequest] = useState(0);
          const [cacheHits, setCacheHits] = useState(0);
          const [cacheMisses, setCacheMisses] = useState(0);
          const [accessHistory, setAccessHistory] = useState([]);
          const [cacheFrequency, setCacheFrequency] = useState({});
          
          // Desfragmentaci√≥n de Disco
          const [diskBlocks, setDiskBlocks] = useState([]);
          const [defragMode, setDefragMode] = useState('sequential');
          const [defragStep, setDefragStep] = useState(0);
          const [selectedBlocks, setSelectedBlocks] = useState([]);
          const timerRef = useRef(null);
          
          // Inicializar disco
          useEffect(() => {
            initializeDisk();
            const requests = Array(30).fill(0).map(() => Math.floor(Math.random() * 12));
            setCacheRequests(requests);
          }, []);
          
          const initializeDisk = () => {
            const initialDisk = Array(64).fill(null).map((_, idx) => {
              const rand = Math.random();
              if (rand < 0.3) return { file: 'Document.pdf', color: 'bg-red-400', fragment: Math.floor(Math.random() * 4) };
              if (rand < 0.5) return { file: 'Video.mp4', color: 'bg-blue-400', fragment: Math.floor(Math.random() * 5) };
              if (rand < 0.65) return { file: 'Music.mp3', color: 'bg-green-400', fragment: Math.floor(Math.random() * 3) };
              if (rand < 0.75) return { file: 'Image.jpg', color: 'bg-yellow-400', fragment: Math.floor(Math.random() * 2) };
              return null;
            });
            setDiskBlocks(initialDisk);
          };
          
          // Limpiar timer al cambiar de tab
          useEffect(() => {
            return () => {
              if (timerRef.current) {
                clearInterval(timerRef.current);
                timerRef.current = null;
              }
            };
          }, [activeTab]);
          
          // Animaci√≥n de Compactaci√≥n
          useEffect(() => {
            if (!isRunning || activeTab !== 'compaction') return;
            
            if (timerRef.current) clearInterval(timerRef.current);
            
            timerRef.current = setInterval(() => {
              setStep(prev => {
                if (prev >= 3) {
                  setIsRunning(false);
                  setCompactionComplete(true);
                  if (timerRef.current) clearInterval(timerRef.current);
                  return prev;
                }
                
                if (prev === 0) {
                  return 1;
                } else if (prev === 1) {
                  const compacted = [];
                  const free = [];
                  memoryBlocks.forEach(block => {
                    if (block.type === 'process') compacted.push(block);
                    else free.push(block);
                  });
                  setMemoryBlocks([...compacted, ...free]);
                  return 2;
                } else if (prev === 2) {
                  const processes = memoryBlocks.filter(b => b.type === 'process');
                  const totalFree = memoryBlocks.filter(b => b.type === 'free').reduce((sum, b) => sum + b.size, 0);
                  if (totalFree > 0) {
                    setMemoryBlocks([...processes, { id: 999, size: totalFree, type: 'free', name: 'Libre Consolidado', color: 'bg-gray-600' }]);
                  }
                  return 3;
                }
                return prev;
              });
            }, speed);
            
            return () => {
              if (timerRef.current) {
                clearInterval(timerRef.current);
                timerRef.current = null;
              }
            };
          }, [isRunning, activeTab, speed, step, memoryBlocks]);
          
          // Animaci√≥n de Cach√©
          useEffect(() => {
            if (!isRunning || activeTab !== 'cache') return;
            
            if (timerRef.current) clearInterval(timerRef.current);
            
            timerRef.current = setInterval(() => {
              if (currentRequest >= cacheRequests.length) {
                setIsRunning(false);
                if (timerRef.current) clearInterval(timerRef.current);
                return;
              }
              
              const request = cacheRequests[currentRequest];
              const cacheIndex = cacheBlocks.indexOf(request);
              
              if (cacheIndex !== -1) {
                setCacheHits(prev => prev + 1);
                setAccessHistory(prev => [...prev, { request, result: 'HIT', color: 'text-green-600' }]);
                setCacheFrequency(prev => ({...prev, [request]: (prev[request] || 0) + 1}));
                
                if (cachePolicy === 'LRU') {
                  const newCache = [...cacheBlocks];
                  newCache.splice(cacheIndex, 1);
                  newCache.push(request);
                  setCacheBlocks(newCache);
                }
              } else {
                setCacheMisses(prev => prev + 1);
                setAccessHistory(prev => [...prev, { request, result: 'MISS', color: 'text-red-600' }]);
                
                const newCache = [...cacheBlocks];
                
                if (cachePolicy === 'FIFO') {
                  newCache.shift();
                  newCache.push(request);
                } else if (cachePolicy === 'LRU') {
                  newCache.shift();
                  newCache.push(request);
                } else if (cachePolicy === 'LFU') {
                  let minFreq = Infinity;
                  let minIdx = 0;
                  newCache.forEach((item, idx) => {
                    if (item !== null) {
                      const freq = cacheFrequency[item] || 0;
                      if (freq < minFreq) {
                        minFreq = freq;
                        minIdx = idx;
                      }
                    }
                  });
                  newCache[minIdx] = request;
                }
                
                setCacheFrequency(prev => ({...prev, [request]: (prev[request] || 0) + 1}));
                setCacheBlocks(newCache);
              }
              
              setCurrentRequest(prev => prev + 1);
            }, speed / 2);
            
            return () => {
              if (timerRef.current) {
                clearInterval(timerRef.current);
                timerRef.current = null;
              }
            };
          }, [isRunning, activeTab, currentRequest, cacheRequests, cacheBlocks, cachePolicy, speed, cacheFrequency]);
          
          // Animaci√≥n de Desfragmentaci√≥n
          useEffect(() => {
            if (!isRunning || activeTab !== 'defrag') return;
            
            if (timerRef.current) clearInterval(timerRef.current);
            
            if (defragMode === 'sequential') {
              timerRef.current = setInterval(() => {
                setDefragStep(prev => {
                  if (prev >= 2) {
                    setIsRunning(false);
                    if (timerRef.current) clearInterval(timerRef.current);
                    return prev;
                  }
                  
                  if (prev === 0) {
                    return 1;
                  } else if (prev === 1) {
                    const files = {};
                    diskBlocks.forEach((block, idx) => {
                      if (block) {
                        if (!files[block.file]) files[block.file] = [];
                        files[block.file].push({ ...block, originalIdx: idx });
                      }
                    });
                    
                    const newDisk = Array(64).fill(null);
                    let position = 0;
                    
                    Object.values(files).forEach(fileBlocks => {
                      fileBlocks.forEach((block, idx) => {
                        newDisk[position++] = { ...block, fragment: idx };
                      });
                    });
                    
                    setDiskBlocks(newDisk);
                    return 2;
                  }
                  return prev;
                });
              }, speed * 1.5);
            } else {
              timerRef.current = setInterval(() => {
                const occupiedIndices = diskBlocks
                  .map((block, idx) => block ? idx : null)
                  .filter(idx => idx !== null);
                
                const freeIndices = diskBlocks
                  .map((block, idx) => !block ? idx : null)
                  .filter(idx => idx !== null);
                
                if (occupiedIndices.length > 0 && freeIndices.length > 0) {
                  const randomOccupied = occupiedIndices[Math.floor(Math.random() * occupiedIndices.length)];
                  const randomFree = freeIndices[Math.floor(Math.random() * freeIndices.length)];
                  
                  setSelectedBlocks([randomOccupied, randomFree]);
                  
                  setTimeout(() => {
                    const newDisk = [...diskBlocks];
                    newDisk[randomFree] = newDisk[randomOccupied];
                    newDisk[randomOccupied] = null;
                    setDiskBlocks(newDisk);
                    setSelectedBlocks([]);
                  }, 300);
                } else {
                  setIsRunning(false);
                  if (timerRef.current) clearInterval(timerRef.current);
                }
              }, speed);
            }
            
            return () => {
              if (timerRef.current) {
                clearInterval(timerRef.current);
                timerRef.current = null;
              }
            };
          }, [isRunning, activeTab, speed, defragStep, diskBlocks, defragMode]);
          
          const resetSimulation = () => {
            setIsRunning(false);
            setStep(0);
            setDefragStep(0);
            setCurrentRequest(0);
            setCacheHits(0);
            setCacheMisses(0);
            setAccessHistory([]);
            setCacheFrequency({});
            setCompactionComplete(false);
            setSelectedBlocks([]);
            
            if (timerRef.current) {
              clearInterval(timerRef.current);
              timerRef.current = null;
            }
            
            if (activeTab === 'compaction') {
              setMemoryBlocks([
                { id: 1, size: 100, type: 'process', name: 'Chrome.exe', color: 'bg-blue-500' },
                { id: 2, size: 50, type: 'free', name: 'Libre', color: 'bg-gray-600' },
                { id: 3, size: 80, type: 'process', name: 'VSCode.exe', color: 'bg-green-500' },
                { id: 4, size: 70, type: 'free', name: 'Libre', color: 'bg-gray-600' },
                { id: 5, size: 90, type: 'process', name: 'Spotify.exe', color: 'bg-purple-500' },
                { id: 6, size: 110, type: 'free', name: 'Libre', color: 'bg-gray-600' }
              ]);
            } else if (activeTab === 'cache') {
              setCacheBlocks(Array(8).fill(null));
              const requests = Array(30).fill(0).map(() => Math.floor(Math.random() * 12));
              setCacheRequests(requests);
            } else {
              initializeDisk();
            }
          };
          
          const allocateMemory = (size) => {
            const freeBlocks = memoryBlocks.map((block, idx) => ({ block, idx })).filter(b => b.block.type === 'free');
            
            let targetIdx = -1;
            
            if (allocationMethod === 'first') {
              targetIdx = freeBlocks.findIndex(b => b.block.size >= size);
            } else if (allocationMethod === 'best') {
              const suitable = freeBlocks.filter(b => b.block.size >= size);
              if (suitable.length > 0) {
                suitable.sort((a, b) => a.block.size - b.block.size);
                targetIdx = freeBlocks.indexOf(suitable[0]);
              }
            } else if (allocationMethod === 'worst') {
              const suitable = freeBlocks.filter(b => b.block.size >= size);
              if (suitable.length > 0) {
                suitable.sort((a, b) => b.block.size - a.block.size);
                targetIdx = freeBlocks.indexOf(suitable[0]);
              }
            }
            
            if (targetIdx !== -1) {
              const block = freeBlocks[targetIdx];
              const newBlocks = [...memoryBlocks];
              const remainingSize = block.block.size - size;
              
              newBlocks[block.idx] = {
                id: Date.now(),
                size: size,
                type: 'process',
                name: 'NewApp.exe',
                color: 'bg-yellow-500'
              };
              
              if (remainingSize > 0) {
                newBlocks.splice(block.idx + 1, 0, {
                  id: Date.now() + 1,
                  size: remainingSize,
                  type: 'free',
                  name: 'Libre',
                  color: 'bg-gray-600'
                });
              }
              
              setMemoryBlocks(newBlocks);
              setCompactionComplete(false);
            } else {
              alert('No hay espacio suficiente disponible. Intenta compactar primero.');
            }
          };
          
          const handleTabChange = (tab) => {
            if (timerRef.current) {
              clearInterval(timerRef.current);
              timerRef.current = null;
            }
            setActiveTab(tab);
            setIsRunning(false);
            resetSimulation();
          };
          
          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-6">
              <div className="max-w-7xl mx-auto">
                <div className="mb-8">
                  <h1 className="text-4xl font-bold mb-2 flex items-center gap-3">
                    <Cpu className="text-cyan-400" />
                    Simulador de Gesti√≥n de Memoria y Almacenamiento
                  </h1>
                  <p className="text-gray-400">Visualizaci√≥n interactiva de algoritmos de sistemas operativos</p>
                </div>
                
                <div className="flex gap-2 mb-6">
                  <button
                    onClick={() => handleTabChange('compaction')}
                    className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                      activeTab === 'compaction' 
                        ? 'bg-cyan-600 text-white shadow-lg scale-105' 
                        : 'bg-slate-700 text-gray-300 hover:bg-slate-600'
                    }`}
                  >
                    <Zap className="inline mr-2" size={18} />
                    Compactaci√≥n RAM
                  </button>
                  <button
                    onClick={() => handleTabChange('cache')}
                    className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                      activeTab === 'cache' 
                        ? 'bg-cyan-600 text-white shadow-lg scale-105' 
                        : 'bg-slate-700 text-gray-300 hover:bg-slate-600'
                    }`}
                  >
                    <Cpu className="inline mr-2" size={18} />
                    Pol√≠ticas de Cach√©
                  </button>
                  <button
                    onClick={() => handleTabChange('defrag')}
                    className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                      activeTab === 'defrag' 
                        ? 'bg-cyan-600 text-white shadow-lg scale-105' 
                        : 'bg-slate-700 text-gray-300 hover:bg-slate-600'
                    }`}
                  >
                    <HardDrive className="inline mr-2" size={18} />
                    Desfragmentaci√≥n Disco
                  </button>
                </div>
                
                <div className="bg-slate-800 rounded-lg p-4 mb-6 flex flex-wrap items-center gap-4">
                  <button
                    onClick={() => setIsRunning(!isRunning)}
                    disabled={activeTab === 'compaction' && compactionComplete}
                    className={`${
                      activeTab === 'compaction' && compactionComplete 
                        ? 'bg-gray-600 cursor-not-allowed' 
                        : 'bg-green-600 hover:bg-green-700'
                    } px-6 py-2 rounded-lg font-semibold flex items-center gap-2 transition-all`}
                  >
                    {isRunning ? <Pause size={18} /> : <Play size={18} />}
                    {isRunning ? 'Pausar' : 'Iniciar'}
                  </button>
                  <button
                    onClick={resetSimulation}
                    className="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-lg font-semibold flex items-center gap-2 transition-all"
                  >
                    <RotateCcw size={18} />
                    Reiniciar
                  </button>
                  <div className="flex items-center gap-3 ml-auto">
                    <label className="text-sm">Velocidad:</label>
                    <input
                      type="range"
                      min="300"
                      max="2000"
                      step="100"
                      value={speed}
                      onChange={(e) => setSpeed(Number(e.target.value))}
                      className="w-32"
                    />
                    <span className="text-sm text-gray-400">{((2100 - speed) / 300).toFixed(1)}x</span>
                  </div>
                </div>
                
                {activeTab === 'compaction' && (
                  <div className="space-y-6">
                    <div className="bg-slate-800 rounded-lg p-6">
                      <div className="flex justify-between items-center mb-4 flex-wrap gap-4">
                        <h2 className="text-2xl font-bold">Memoria RAM - Vector Din√°mico</h2>
                        <div className="flex gap-2 flex-wrap">
                          <select
                            value={allocationMethod}
                            onChange={(e) => setAllocationMethod(e.target.value)}
                            className="bg-slate-700 px-4 py-2 rounded-lg text-white"
                          >
                            <option value="first">Primer Ajuste (First Fit)</option>
                            <option value="best">Mejor Ajuste (Best Fit)</option>
                            <option value="worst">Peor Ajuste (Worst Fit)</option>
                          </select>
                          <button
                            onClick={() => allocateMemory(60)}
                            className="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-all"
                          >
                            Asignar 60 MB
                          </button>
                        </div>
                      </div>
                      
                      <div className="bg-blue-900 bg-opacity-30 border border-blue-500 rounded-lg p-3 mb-4 flex items-start gap-2">
                        <Info size={20} className="text-blue-400 flex-shrink-0 mt-0.5" />
                        <div className="text-sm text-blue-200">
                          <strong>C√≥mo usar:</strong> Presiona "Iniciar" para ver la compactaci√≥n. Puedes usar "Asignar 60 MB" para probar los algoritmos de ajuste antes o despu√©s de compactar.
                        </div>
                      </div>
                      
                      <div className="bg-slate-900 rounded-lg p-4 mb-4">
                        <div className="text-sm mb-2 text-gray-400 font-semibold">Estado: {
                          step === 0 ? '‚ö†Ô∏è Memoria fragmentada - Hay ' + memoryBlocks.filter(b => b.type === 'free').length + ' espacios libres dispersos' :
                          step === 1 ? 'üîÑ Identificando espacios libres...' :
                          step === 2 ? 'üì¶ Moviendo procesos al inicio...' :
                          '‚úÖ Memoria compactada - Espacio libre consolidado'
                        }</div>
                        <div className="space-y-2">
                          {memoryBlocks.map((block, idx) => (
                            <div
                              key={block.id}
                              className="flex items-center transition-all duration-500"
                              style={{ 
                                transform: step >= 1 && block.type === 'process' ? 'translateX(0)' : 'none'
                              }}
                            >
                              <div
                                className={`${block.color} rounded-lg p-3 transition-all duration-500 shadow-lg`}
                                style={{ width: `${(block.size / 600) * 100}%` }}
                              >
                                <div className="flex justify-between items-center">
                                  <span className="font-semibold text-white">{block.name}</span>
                                  <span className="text-sm text-white">{block.size} MB</span>
                                </div>
                              </div>
                              {block.type === 'process' && (
                                <div className="ml-2 text-xs text-gray-400">PID: {block.id}</div>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-3 gap-4 text-sm">
                        <div className="bg-slate-700 rounded p-3">
                          <div className="text-gray-400 mb-1">Espacio Usado</div>
                          <div className="text-xl font-bold">
                            {memoryBlocks.filter(b => b.type === 'process').reduce((sum, b) => sum + b.size, 0)} MB
                          </div>
                        </div>
                        <div className="bg-slate-700 rounded p-3">
                          <div className="text-gray-400 mb-1">Espacio Libre</div>
                          <div className="text-xl font-bold text-green-400">
                            {memoryBlocks.filter(b => b.type === 'free').reduce((sum, b) => sum + b.size, 0)} MB
                          </div>
                        </div>
                        <div className="bg-slate-700 rounded p-3">
                          <div className="text-gray-400 mb-1">Fragmentos Libres</div>
                          <div className="text-xl font-bold text-yellow-400">
                            {memoryBlocks.filter(b => b.type === 'free').length}
                          </div>
                        </div>
                      </div>
                      
                      <div className="mt-4 bg-slate-700 rounded p-3 text-sm">
                        <strong className="text-cyan-400">Algoritmo seleccionado:</strong> {
                          allocationMethod === 'first' ? 'Primer Ajuste - Asigna en el primer espacio suficiente' :
                          allocationMethod === 'best' ? 'Mejor Ajuste - Busca el espacio que menos desperdicia' :
                          'Peor Ajuste - Usa el espacio m√°s grande disponible'
                        }
                      </div>
                    </div>
                  </div>
                )}
                
                {activeTab === 'cache' && (
                  <div className="space-y-6">
                    <div className="bg-slate-800 rounded-lg p-6">
                      <div className="flex justify-between items-center mb-4 flex-wrap gap-4">
                        <h2 className="text-2xl font-bold">Cach√© de CPU - Pol√≠ticas de Reemplazo</h2>
                        <select
                          value={cachePolicy}
                          onChange={(e) => { setCachePolicy(e.target.value); resetSimulation(); }}
                          className="bg-slate-700 px-4 py-2 rounded-lg text-white"
                          disabled={isRunning}
                        >
                          <option value="FIFO">FIFO (First In First Out)</option>
                          <option value="LRU">LRU (Least Recently Used)</option>
                          <option value="LFU">LFU (Least Frequently Used)</option>
                        </select>
                      </div>
                      
                      <div className="bg-blue-900 bg-opacity-30 border border-blue-500 rounded-lg p-3 mb-4 flex items-start gap-2">
                        <Info size={20} className="text-blue-400 flex-shrink-0 mt-0.5" />
                        <div className="text-sm text-blue-200">
                          <strong>C√≥mo usar:</strong> Selecciona una pol√≠tica y presiona "Iniciar" para ver c√≥mo se procesan 30 accesos a p√°ginas. Verde = HIT (en cach√©), Rojo = MISS (no en cach√©).
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-2 gap-6">
                        <div>
                          <h3 className="text-lg font-semibold mb-3">Estado del Cach√© (8 bloques)</h3>
                          <div className="bg-slate-900 rounded-lg p-4">
                            <div className="grid grid-cols-4 gap-2">
                              {cacheBlocks.map((block, idx) => (
                                <div
                                  key={idx}
                                  className={`h-16 rounded flex items-center justify-center font-bold text-lg transition-all duration-300 ${
                                    block !== null ? 'bg-cyan-600 scale-105 shadow-lg' : 'bg-slate-700'
                                  }`}
                                >
                                  {block !== null ? `#${block}` : '-'}
                                </div>
                              ))}
                            </div>
                          </div>
                          
                          <div className="mt-4 text-sm bg-slate-700 rounded p-3">
                            <strong className="text-cyan-400">Pol√≠tica:</strong> {
                              cachePolicy === 'FIFO' ? 'Reemplaza la p√°gina m√°s antigua' :
                              cachePolicy === 'LRU' ? 'Reemplaza la menos usada recientemente' :
                              'Reemplaza la menos frecuentemente usada'
                            }
                          </div>
                        </div>
                        
                        <div>
                          <h3 className="text-lg font-semibold mb-3">√öltimos 10 Accesos</h3>
                          <div className="bg-slate-900 rounded-lg p-4 h-64 overflow-y-auto">
                            {accessHistory.length === 0 && (
                              <div className="text-gray-500 text-center py-8">
                                Presiona "Iniciar" para ver los accesos
                              </div>
                            )}
                            {accessHistory.slice(-10).reverse().map((access, idx) => (
                              <div key={idx} className="mb-2 flex justify-between items-center bg-slate-800 p-2 rounded">
                                <span>P√°gina #{access.request}</span>
                                <span className={`font-bold px-3 py-1 rounded ${
                                  access.result === 'HIT' ? 'bg-green-600' : 'bg-red-600'
                                }`}>{access.result}</span>
                              </div>
                            ))}
                          </div>
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-4 gap-4 mt-6 text-sm">
                        <div className="bg-green-900 bg-opacity-50 border border-green-500 rounded p-3">
                          <div className="text-green-300 mb-1">Hits (Aciertos)</div>
                          <div className="text-2xl font-bold text-green-400">{cacheHits}</div>
                        </div>
                        <div className="bg-red-900 bg-opacity-50 border border-red-500 rounded p-3">
                          <div className="text-red-300 mb-1">Misses (Fallos)</div>
                          <div className="text-2xl font-bold text-red-400">{cacheMisses}</div>
                        </div>
                        <div className="bg-slate-700 rounded p-3">
                          <div className="text-gray-400 mb-1">Total Accesos</div>
                          <div className="text-2xl font-bold">{cacheHits + cacheMisses} / 30</div>
                        </div>
                        <div className="bg-cyan-900 bg-opacity-50 border border-cyan-500 rounded p-3">
                          <div className="text-cyan-300 mb-1">Tasa de Aciertos</div>
                          <div className="text-2xl font-bold text-cyan-400">
                            {cacheHits + cacheMisses > 0 ? Math.round((cacheHits / (cacheHits + cacheMisses)) * 100) : 0}%
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
                
                {activeTab === 'defrag' && (
                  <div className="space-y-6">
                    <div className="bg-slate-800 rounded-lg p-6">
                      <div className="flex justify-between items-center mb-4 flex-wrap gap-4">
                        <h2 className="text-2xl font-bold">Disco Duro - Matriz de Sectores</h2>
                        <div className="flex gap-2">
                          <select
                            value={defragMode}
                            onChange={(e) => { setDefragMode(e.target.value); resetSimulation(); }}
                            className="bg-slate-700 px-4 py-2 rounded-lg text-white"
                            disabled={isRunning}
                          >
                            <option value="sequential">Desfragmentaci√≥n Completa</option>
                            <option value="random">Modo Aleatorio (Mover bloques)</option>
                          </select>
                        </div>
                      </div>
                      
                      <div className="bg-blue-900 bg-opacity-30 border border-blue-500 rounded-lg p-3 mb-4 flex items-start gap-2">
                        <Info size={20} className="text-blue-400 flex-shrink-0 mt-0.5" />
                        <div className="text-sm text-blue-200">
                          <strong>C√≥mo usar:</strong> {
                            defragMode === 'sequential' 
                              ? 'Presiona "Iniciar" para reorganizar todos los archivos y consolidar el espacio libre.'
                              : 'Presiona "Iniciar" para mover bloques aleatoriamente hacia espacios libres. Observa c√≥mo se redistribuyen los sectores.'
                          }
                        </div>
                      </div>
                      
                      <div className="bg-slate-900 rounded-lg p-4 mb-4">
                        <div className="text-sm mb-3 text-gray-400 font-semibold">
                          {defragMode === 'sequential' ? (
                            defragStep === 0 ? '‚ö†Ô∏è Disco fragmentado - Los archivos est√°n dispersos' :
                            defragStep === 1 ? 'üîÑ Reorganizando archivos contiguos...' :
                            '‚úÖ Disco defragmentado - Archivos agrupados, espacio libre consolidado'
                          ) : (
                            isRunning ? 'üé≤ Moviendo bloques aleatoriamente...' : 'üé≤ Modo aleatorio activado - Los bloques se mover√°n al azar'
                          )}
                        </div>
                        <div className="grid grid-cols-8 gap-1">
                          {diskBlocks.map((block, idx) => (
                            <div
                              key={idx}
                              className={`h-14 rounded flex items-center justify-center text-xs font-semibold transition-all duration-500 ${
                                block ? block.color : 'bg-slate-700'
                              } ${
                                selectedBlocks.includes(idx) ? 'ring-4 ring-yellow-400 scale-110' : ''
                              }`}
                              style={{
                                transform: defragStep >= 1 && defragMode === 'sequential' ? 'scale(1)' : 'scale(0.95)',
                              }}
                            >
                              {block && (
                                <div className="text-center text-white">
                                  <div className="font-bold">{block.file.split('.')[0].substring(0, 4)}</div>
                                  <div className="text-[10px] opacity-80">frag #{block.fragment}</div>
                                </div>
                              )}
                              {!block && (
                                <div className="text-gray-500 text-[10px]">{idx}</div>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>
                      
                      <div className="grid grid-cols-3 gap-4 text-sm mb-4">
                        <div className="bg-slate-700 rounded p-3">
                          <div className="text-gray-400 mb-1">Sectores Ocupados</div>
                          <div className="text-xl font-bold">
                            {diskBlocks.filter(b => b !== null).length} / 64
                          </div>
                        </div>
                        <div className="bg-slate-700 rounded p-3">
                          <div className="text-gray-400 mb-1">Sectores Libres</div>
                          <div className="text-xl font-bold text-green-400">
                            {diskBlocks.filter(b => b === null).length}
                          </div>
                        </div>
                        <div className="bg-slate-700 rounded p-3">
                          <div className="text-gray-400 mb-1">Archivos Distintos</div>
                          <div className="text-xl font-bold text-blue-400">
                            {new Set(diskBlocks.filter(b => b).map(b => b.file)).size}
                          </div>
                        </div>
                      </div>
                      
                      <div className="bg-slate-700 rounded p-4">
                        <div className="text-sm font-semibold mb-2 text-gray-300">Leyenda de Archivos:</div>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                          <div className="flex items-center gap-2">
                            <div className="w-6 h-6 bg-red-400 rounded"></div>
                            <span className="text-sm">Document.pdf</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-6 h-6 bg-blue-400 rounded"></div>
                            <span className="text-sm">Video.mp4</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-6 h-6 bg-green-400 rounded"></div>
                            <span className="text-sm">Music.mp3</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <div className="w-6 h-6 bg-yellow-400 rounded"></div>
                            <span className="text-sm">Image.jpg</span>
                          </div>
                        </div>
                      </div>
                      
                      <div className="mt-4 bg-slate-700 rounded p-3 text-sm">
                        <strong className="text-cyan-400">Modo actual:</strong> {
                          defragMode === 'sequential' 
                            ? 'Desfragmentaci√≥n completa - Agrupa todos los archivos del mismo tipo de forma contigua' 
                            : 'Aleatorio - Mueve bloques individuales a posiciones libres al azar (simula reorganizaci√≥n din√°mica)'
                        }
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<MemoryDiskSimulator />, document.getElementById('root'));
    </script>
</body>
</html>
